// ChatList.js
import React, { useEffect, useState } from "react";
import {
  addDoc,
  collection,
  getFirestore,
  onSnapshot,
  query,
} from "firebase/firestore";
import { Link } from "react-router-dom";
import { useFirebase } from "./FirebaseDataProv";
import firebaseData from "./FirebaseData";

const db = getFirestore(firebaseData);

const ChatList = () => {
  const { user } = useFirebase();
  const [chats, setChats] = useState([]);

  useEffect(() => {
    const usersCollectionRef = collection(db, "users");

    const unsubscribeUsers = onSnapshot(usersCollectionRef, (snapshot) => {
      const usersData = snapshot.docs.map((doc) => ({
        id: doc.id,
        ...doc.data(),
      }));

      console.log("User Data from Firestore:", usersData);
      setChats(usersData);
    });

    return () => {
      unsubscribeUsers();
    };
  }, [db]);

  return (
    <div className=" h-screen " id="cahtlist">
      <div className="flex">
        {" "}
        <div className="chat-list-container min-w-[360px]  max-w-[360px] pb-5 border max-h-screen min-h-screen overflow-auto relative">
          {/* controle bar  */}
          <div className=" sticky top-0 bg-white z-50 px-4 pt-5 pb-6 ">
            {" "}
            <div className="nav-chat-screen flex justify-between items-center bg-white">
              <div className=" flex gap-6 items-center">
                <div className="profile flex justify-center items-center">
                  <svg
                    width="40"
                    height="40"
                    viewBox="0 0 40 40"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg">
                    <circle cx="20" cy="20" r="20" fill="#EBF1FF" />
                    <path
                      d="M14.5776 23.4816L14.9613 24.126L14.9613 24.126L14.5776 23.4816ZM11.7127 28.1966L11.1953 28.7396L11.1953 28.7396L11.7127 28.1966ZM28.2873 28.1966L28.8046 28.7396L28.8046 28.7396L28.2873 28.1966ZM25.4224 23.4816L25.0387 24.126L25.0387 24.126L25.4224 23.4816ZM14.1939 22.8372C13.5679 23.2099 12.1493 23.9244 11.2427 24.8118C10.781 25.2637 10.3424 25.8592 10.2627 26.5888C10.1778 27.3646 10.5163 28.0927 11.1953 28.7396L12.23 27.6536C11.7794 27.2243 11.7343 26.9301 11.7538 26.7518C11.7783 26.5271 11.9318 26.2363 12.292 25.8838C13.0289 25.1624 14.1725 24.5957 14.9613 24.126L14.1939 22.8372ZM11.1953 28.7396C12.3668 29.8556 13.7726 30.75 15.5909 30.75V29.25C14.3184 29.25 13.2658 28.6404 12.23 27.6536L11.1953 28.7396ZM15.5909 30.75H24.4091V29.25H15.5909V30.75ZM24.4091 30.75C26.2274 30.75 27.6332 29.8556 28.8046 28.7396L27.77 27.6536C26.7342 28.6404 25.6816 29.25 24.4091 29.25V30.75ZM28.8046 28.7396C29.4837 28.0927 29.8221 27.3646 29.7373 26.5888C29.6576 25.8592 29.2189 25.2637 28.7573 24.8118C27.8506 23.9244 26.4321 23.2099 25.8061 22.8372L25.0387 24.126C25.8275 24.5957 26.9711 25.1624 27.708 25.8838C28.0681 26.2363 28.2216 26.5271 28.2462 26.7517C28.2657 26.9301 28.2206 27.2243 27.77 27.6536L28.8046 28.7396ZM25.8061 22.8372C22.2521 20.7209 17.7479 20.7209 14.1939 22.8372L14.9613 24.126C18.0425 22.2913 21.9575 22.2913 25.0387 24.126L25.8061 22.8372ZM23.75 14.5C23.75 16.5711 22.0711 18.25 20 18.25V19.75C22.8995 19.75 25.25 17.3995 25.25 14.5H23.75ZM20 18.25C17.9289 18.25 16.25 16.5711 16.25 14.5H14.75C14.75 17.3995 17.1005 19.75 20 19.75V18.25ZM16.25 14.5C16.25 12.4289 17.9289 10.75 20 10.75V9.25C17.1005 9.25 14.75 11.6005 14.75 14.5H16.25ZM20 10.75C22.0711 10.75 23.75 12.4289 23.75 14.5H25.25C25.25 11.6005 22.8995 9.25 20 9.25V10.75Z"
                      fill="#404B5A"
                    />
                  </svg>
                </div>
                <h1>Chats</h1>
              </div>
              <svg
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                xmlns="http://www.w3.org/2000/svg">
                <path
                  d="M14.0737 3.88545L13.5226 3.37676L13.5226 3.37677L14.0737 3.88545ZM15.5874 2.43893L15.204 1.79432L15.204 1.79433L15.5874 2.43893ZM18.6904 2.39232L19.0545 1.73661L19.0544 1.73659L18.6904 2.39232ZM21.6159 5.38093L20.9537 5.7331L20.9538 5.73321L21.6159 5.38093ZM21.5703 8.5507L20.9187 8.17933L20.9187 8.17935L21.5703 8.5507ZM20.1543 10.097L20.6746 10.6372L20.6746 10.6372L20.1543 10.097ZM10.7506 19.1543L10.2303 18.6141L10.2303 18.6141L10.7506 19.1543ZM7.56806 21.6837L7.29524 20.9851L7.29517 20.9851L7.56806 21.6837ZM3.54536 21.9686L3.56496 21.2189H3.56491L3.54536 21.9686ZM3.26538 21.9613L3.24575 22.711L3.24583 22.711L3.26538 21.9613ZM2.14359 21.73L2.70638 21.2342L2.70625 21.2341L2.14359 21.73ZM2.03608 20.5662L1.28835 20.5079L1.28835 20.5079L2.03608 20.5662ZM2.06308 20.2197L2.81081 20.278L2.81082 20.278L2.06308 20.2197ZM2.62371 16.7182L3.31159 17.0171L3.3116 17.0171L2.62371 16.7182ZM4.78943 13.9445L4.2383 13.4358L4.23829 13.4358L4.78943 13.9445ZM14 21.25C13.5858 21.25 13.25 21.5858 13.25 22C13.25 22.4142 13.5858 22.75 14 22.75V21.25ZM22 22.75C22.4142 22.75 22.75 22.4142 22.75 22C22.75 21.5858 22.4142 21.25 22 21.25V22.75ZM14.6248 4.39414C15.4069 3.54678 15.6924 3.24908 15.9708 3.08353L15.204 1.79433C14.6906 2.09972 14.2309 2.60938 13.5226 3.37676L14.6248 4.39414ZM15.9708 3.08354C16.6968 2.65173 17.5886 2.63845 18.3264 3.04805L19.0544 1.73659C17.8496 1.06773 16.3886 1.08979 15.204 1.79432L15.9708 3.08354ZM18.3263 3.04803C18.6091 3.20503 18.9028 3.49381 19.7091 4.31741L20.781 3.26811C20.051 2.52243 19.5767 2.02657 19.0545 1.73661L18.3263 3.04803ZM19.7091 4.31741C20.5143 5.13999 20.7985 5.44128 20.9537 5.7331L22.2781 5.02876C21.9959 4.49816 21.5119 4.01481 20.781 3.26811L19.7091 4.31741ZM20.9538 5.73321C21.361 6.49848 21.3475 7.42702 20.9187 8.17933L22.2219 8.92207C22.9055 7.72256 22.9267 6.24776 22.278 5.02865L20.9538 5.73321ZM20.9187 8.17935C20.7552 8.46625 20.4626 8.75876 19.634 9.55683L20.6746 10.6372C21.4266 9.9128 21.9244 9.44407 22.2219 8.92205L20.9187 8.17935ZM19.634 9.55681L10.2303 18.6141L11.2709 19.6945L20.6746 10.6372L19.634 9.55681ZM10.2303 18.6141C8.68779 20.0999 8.059 20.6868 7.29524 20.9851L7.84088 22.3823C8.949 21.9496 9.81797 21.0939 11.2709 19.6945L10.2303 18.6141ZM7.29517 20.9851C6.53305 21.2828 5.68468 21.2743 3.56496 21.2189L3.52576 22.7183C5.52172 22.7705 6.73119 22.8158 7.84095 22.3823L7.29517 20.9851ZM3.56491 21.2189L3.28493 21.2116L3.24583 22.711L3.52581 22.7183L3.56491 21.2189ZM3.28501 21.2116C3.12549 21.2074 2.99915 21.204 2.89066 21.1983C2.78173 21.1926 2.71034 21.1854 2.6613 21.1772C2.56911 21.1619 2.63803 21.1567 2.70638 21.2342L1.5808 22.2258C1.83123 22.51 2.14781 22.6123 2.41438 22.6568C2.65764 22.6974 2.95475 22.7034 3.24575 22.711L3.28501 21.2116ZM2.70625 21.2341C2.77242 21.3092 2.7575 21.3715 2.75175 21.2682C2.74487 21.1448 2.7573 20.9648 2.78381 20.6245L1.28835 20.5079C1.26514 20.8057 1.24028 21.1043 1.25407 21.3517C1.26897 21.6191 1.33267 21.9442 1.58094 22.2259L2.70625 21.2341ZM2.78381 20.6245L2.81081 20.278L1.31535 20.1614L1.28835 20.5079L2.78381 20.6245ZM2.81082 20.278C2.95467 18.4313 3.02254 17.6824 3.31159 17.0171L1.93583 16.4193C1.5234 17.3686 1.45135 18.4157 1.31535 20.1614L2.81082 20.278ZM3.3116 17.0171C3.60008 16.353 4.09644 15.8012 5.34057 14.4532L4.23829 13.4358C3.06244 14.7098 2.3488 15.4688 1.93582 16.4193L3.3116 17.0171ZM5.34056 14.4532L14.6248 4.39413L13.5226 3.37677L4.2383 13.4358L5.34056 14.4532ZM12.4697 4.53033L19.4697 11.5303L20.5303 10.4697L13.5303 3.46967L12.4697 4.53033ZM14 22.75H22V21.25H14V22.75Z"
                  fill="#404B5A"
                />
              </svg>
            </div>
            {/* search caht  input */}
            <form action="" className=" inline-block w-full relative mt-5">
              <svg
                className=" absolute top-1/2 -translate-y-1/2 left-[10px]"
                width="20"
                height="20"
                viewBox="0 0 20 20"
                fill="none"
                xmlns="http://www.w3.org/2000/svg">
                <g clip-path="url(#clip0_1_831)">
                  <path
                    d="M14.5834 14.5833L18.3334 18.3333M16.6667 9.16666C16.6667 5.02452 13.3089 1.66666 9.16669 1.66666C5.02455 1.66666 1.66669 5.02452 1.66669 9.16666C1.66669 13.3088 5.02455 16.6667 9.16669 16.6667C13.3089 16.6667 16.6667 13.3088 16.6667 9.16666Z"
                    stroke="#404B5A"
                    stroke-width="1.5"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  />
                </g>
                <defs>
                  <clipPath id="clip0_1_831">
                    <rect width="20" height="20" fill="white" />
                  </clipPath>
                </defs>
              </svg>

              <input placeholder="Search..." className="w-full" type="text" />
            </form>
          </div>
          {/* caht list */}

          <ul className=" px-3">
            {chats.map((chat, i) => (
              // <li>
              //  </Link>
              // </li>
              <Link to={`/chat/${i}`}>
                <li
                  key={chat.id}
                  className=" chatAccesBtn relative hover:bg-[#3348FF] group">
                  <div className="profile relative">
                    <svg
                      className="status absolute bottom-0 right-0 -translate-x-[30%] -translate-y-[40%]"
                      width="10"
                      height="10"
                      viewBox="0 0 10 10"
                      fill="none"
                      xmlns="http://www.w3.org/2000/svg">
                      <circle
                        cx="5"
                        cy="5"
                        r="4.5"
                        fill="#00EA41"
                        stroke="white"
                      />
                    </svg>
                  </div>
                  <div>
                    <div className="  w-full ">
                      <p>Name: {chat.displayName}</p>
                      <p>Email: {chat.email}</p>
                      <h2
                        className="group-hover:text-white
">
                        {chat.displayName}
                      </h2>
                      <p className="group-hover:text-white">See you good bye</p>
                      <h3 className="timestamp absolute top-[8px] right-2 group-hover:text-white ">
                        19:45
                      </h3>
                    </div>
                  </div>
                </li>
              </Link>
            ))}
          </ul>
        </div>
      </div>
    </div>
  );
};

export default ChatList;
